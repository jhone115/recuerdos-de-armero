<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lado A - Exposici贸n</title>
    <link rel="stylesheet" href="../estilos/armero.css">
    <link rel="icon" type="image/png" href="../../recursos/imagenes/logos/Logo - Conmemoraci贸n Armero_1-03.png">
    <!-- Agrega los estilos CSS que te proporcion茅 arriba aqu铆 -->
    <style>
        .flecha-siguiente {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            display: none;
        }
        
        .flecha-siguiente.mostrar {
            opacity: 1;
            visibility: visible;
            display: block;
        }
        
        .flecha-siguiente img {
            width: 60px;
            height: 60px;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
        }
        
        /* Estilos para el modal de activaci贸n de audio */
        .modal-audio {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .modal-audio.oculto {
            opacity: 0;
            pointer-events: none;
        }

        .contenido-modal {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .contenido-modal h2 {
            margin-bottom: 15px;
            color: #333;
        }

        .contenido-modal p {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.5;
        }

        .btn-activar-audio {
            background-color: #4a6fa5;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .btn-activar-audio:hover {
            background-color: #3a5a80;
        }

        /* Indicador de audio activo */
        .indicador-audio {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }

        .indicador-audio.mostrar {
            display: block;
        }       
    </style>
</head>
<body>
    <!-- Indicador de audio activo -->
    <div class="indicador-audio" id="indicadorAudio">
         Audio activo
    </div>

    <!-- Modal para activar el audio -->
    <div class="modal-audio" id="modalAudio">
        <div class="contenido-modal">
            <h2>Continuar experiencia auditiva</h2>
            <p>El audio de fondo contin煤a desde donde lo dejaste. Haz clic para activarlo.</p>
            <button class="btn-activar-audio" id="btnActivarAudio">Activar Audio</button>
        </div>
    </div>

    <a href="a.html" class="flecha-volver arriba-izquierda">
        <img src="../../recursos/imagenes/atras.png" alt="Volver a galer铆a">
    </a>
    
    <a href="../lado b/b.html" class="flecha-volver abajo-derecha" id="flecha-siguiente" style="display: none;">
        <img src="../../recursos/imagenes/adelante.png" alt="Siguiente secci贸n">
    </a>
    
    <div class="container-exposicion">
        <audio id="bgMusic" loop>
            <source src="../../recursos/sonoros/Armero ciudad blanca (Rafael Falla Nieto)(MP3_160K).mp3" type="audio/mpeg">
            Tu navegador no soporta el elemento de audio.
        </audio>
        
        <!-- Fondo est谩tico -->
        <div class="fondo-estatico"></div>
        
        <!-- Contenedor de la polaroid con t铆tulo integrado -->
        <div class="contenedor-polaroid">
            <div class="marco-polaroid">
                <!-- Imagen ampliada -->
                <img id="polaroid-imagen" class="polaroid-imagen" src="" alt="Imagen ampliada">
                
                <!-- T铆tulo de la imagen (dentro de la polaroid) -->
                <div class="titulo-polaroid">
                    <h1 id="titulo-imagen">T铆tulo de la imagen</h1>
                </div>
            </div>
        </div>
        
        <!-- Texto descriptivo (separado, debajo) -->
        <div class="texto-container">
            <p id="texto-imagen">Descripci贸n de la imagen...</p>
        </div>
    </div>
    
  <script>
        // Almacenamiento para mantener el estado del audio entre p谩ginas
        const AUDIO_STORAGE_KEY = 'audioEstadoArmero';
        
        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('bgMusic');
            const modalAudio = document.getElementById('modalAudio');
            const btnActivarAudio = document.getElementById('btnActivarAudio');
            const indicadorAudio = document.getElementById('indicadorAudio');
            
            // Cargar estado del audio desde localStorage
            const estadoAudioGuardado = localStorage.getItem(AUDIO_STORAGE_KEY);
            
            if (estadoAudioGuardado) {
                const estadoAudio = JSON.parse(estadoAudioGuardado);
                
                // Si el audio estaba reproduci茅ndose, intentar continuar
                if (estadoAudio.reproduciendo) {
                    // Establecer el tiempo donde se qued贸
                    audio.currentTime = estadoAudio.tiempoActual || 0;
                    
                    // Ocultar el modal
                    modalAudio.classList.add('oculto');
                    
                    // Mostrar indicador de audio activo
                    indicadorAudio.classList.add('mostrar');
                    
                    // Intentar reproducir
                    audio.play().then(() => {
                        console.log("Audio continuado desde:", audio.currentTime);
                    }).catch(error => {
                        console.log("No se pudo continuar autom谩ticamente:", error);
                        // Si falla, mostrar el modal para interacci贸n del usuario
                        modalAudio.classList.remove('oculto');
                        indicadorAudio.classList.remove('mostrar');
                    });
                } else {
                    // Si no estaba reproduci茅ndose, solo establecer el tiempo
                    audio.currentTime = estadoAudio.tiempoActual || 0;
                    modalAudio.classList.add('oculto');
                }
            } else {
                // Si no hay estado guardado, mostrar el modal
                modalAudio.classList.remove('oculto');
            }
            
            // Configurar el bot贸n para activar el audio
            btnActivarAudio.addEventListener('click', function() {
                audio.play().then(function() {
                    // Ocultar el modal cuando el audio se reproduzca correctamente
                    modalAudio.classList.add('oculto');
                    
                    // Mostrar indicador
                    indicadorAudio.classList.add('mostrar');
                    
                    // Guardar estado del audio
                    guardarEstadoAudio(audio);
                }).catch(function(error) {
                    console.error("Error al reproducir el audio:", error);
                    alert("No se pudo reproducir el audio. Por favor, verifica que tu navegador permita la reproducci贸n de audio.");
                });
            });
            
            // Actualizar el estado del audio peri贸dicamente
            setInterval(function() {
                guardarEstadoAudio(audio);
            }, 1000); // Actualizar cada segundo
            
            // Guardar estado cuando la p谩gina se cierre o se navegue
            window.addEventListener('beforeunload', function() {
                guardarEstadoAudio(audio);
            });
            
            // Funci贸n para guardar el estado del audio
            function guardarEstadoAudio(audioElement) {
                const estadoAudio = {
                    reproduciendo: !audioElement.paused,
                    tiempoActual: audioElement.currentTime,
                    volumen: audioElement.volume,
                    timestamp: Date.now()
                };
                
                localStorage.setItem(AUDIO_STORAGE_KEY, JSON.stringify(estadoAudio));
            }
            
            // Limpiar estado despu茅s de 30 minutos de inactividad (opcional)
            setInterval(function() {
                const estadoAudioGuardado = localStorage.getItem(AUDIO_STORAGE_KEY);
                if (estadoAudioGuardado) {
                    const estadoAudio = JSON.parse(estadoAudioGuardado);
                    const tiempoTranscurrido = Date.now() - estadoAudio.timestamp;
                    
                    // Si han pasado m谩s de 30 minutos, limpiar el estado
                    if (tiempoTranscurrido > 30 * 60 * 1000) {
                        localStorage.removeItem(AUDIO_STORAGE_KEY);
                    }
                }
            }, 5 * 60 * 1000); // Verificar cada 5 minutos
        });
    </script>
    
    <!-- Ahora modifica el archivo a_exp.js seg煤n lo siguiente -->
    <script src="a_exp.js"></script>
</body>
</html>